
-------------------------------------------------------------------------------------

# Основы реляционных БД

### Типы данных: числовые

- `serial` — целое с автоувеличением, от 1 до 2147483647
- `smallint`, `int2` — целое, от -32768 до +32767;
- `integer`, `int`, `int4` — целое, от -2147483648 до +2147483647
- `bigint`, `int8` — целое, от -9 223 372 036 854 775 808 до 9 223 372 036 854 775 807
- `double precision`, `float8` — с плавающей точкой, от 1E-307 до 1E+308

### Типы данных: стоковые

- `character(n)`, `char(n)` — представляет строку из фиксированного количества символов. С помощью параметра задается количество символов в строке;
- `character varying(n)`, `varchar(n)` - представляет строку из фиксированного количества символов. С помощью параметра задается количество символов в строке;
- `text` — представляет текст произвольной длины.

char(n) и varchar(n) - это оба типы данных для хранения строковых значений, где n - это максимальная длина строки. Однако они имеют несколько различий:
1. Фиксированная длина vs. переменная длина:
char(n): Этот тип данных хранит строки фиксированной длины, где каждая строка будет занимать точно n символов, даже если фактическая длина строки меньше. Если строка короче n, то она дополняется пробелами до длины n.
varchar(n): Этот тип данных хранит строки переменной длины, где фактическая длина строки может быть меньше n, но не может превышать n. Память используется только для хранения фактических символов строки, а не для дополнения пробелами.
2. Использование памяти:
char(n): Использует фиксированное количество памяти для каждой строки, даже если фактическая длина строки меньше n. Это может привести к избыточному использованию памяти, особенно если большинство строк короткие.
varchar(n): Использует только столько памяти, сколько необходимо для хранения фактических символов строки, плюс дополнительные байты для хранения длины строки. Это более эффективно использование памяти, особенно для строк переменной длины. 
3. Скорость доступа:
char(n): Обычно обеспечивает более быстрый доступ к данным, поскольку каждая строка имеет фиксированную длину, что упрощает процесс доступа к строкам.
varchar(n): В некоторых случаях может быть немного медленнее, так как требует дополнительного времени на обработку переменной длины.

### Типы данных: время и даты

- `timestamp` — хранит дату и время, с учётом часового пояса или без. Для дат самое нижнее значение 4713 год до н. э., самое верхнее значение 294276 год н. э.
- `date` — представляет дату от 4713 год до н. э. до 5874897 года н.э
- `time` — хранит время суток, без даты, с учётом часового пояса или без. Принимает значения от 00:00:00 до 24:00:00

### Типы данных: прочие

- `boolean` — булево значение, true или false
- `jsonb` — данные произвольного формата в формате JSON

## Data Definition Language, Data Control Language,

**DDL** — подмножество языка SQL, предназначенное для создания, изменения и удаления баз данных и таблиц в них. К нему относятся все команды, начинающиеся с CREATE, ALTER и DROP.

**DCL** — подмножество языка SQL, предназначенное для управления правами доступа к базам данным и таблицам в них. С помощью него можно разрешить и запрещать пользователям создавать, изменять и удалять базы данных или таблицы. К нему относятся все команды, начинающиеся на GRANT и REVOKE.

## SQL: создание пользователя СУБД

```sql
CREATE USER test_user WITH PASSWORD 'qwerty';
```

Пользователь создаётся именно в СУБД!

## SQL: создание базы данных

```sql
CREATE DATABASE test_db OWNER test_user
```

Любая база должна быть создана, прежде чем к ней можно будет подключиться.
Пользователь, указанный как owner, будет иметь максимальные права доступа к этой базе данных.

## SQL: права пользователя в БД

```sql
GRANT ALL PRIVILEGES ON DATABASE test_db TO test_user;
```

По умолчанию доступ к базе имеет только owner и супер-администратор СУБД. Всем остальным пользователям доступ нужно добавлять явным образом.

## SQL: удаление базы данных

```sql
DROP DATABASE test_db;
```

Удалить базу данных может её владелец, супер-администратор СУБД или пользователь, которому явным образом даны на это права.

## SQL: создание таблицы

```sql
CREATE TABLE students (
id serial PRIMARY KEY, name varchar(80), age integer
);
```

# Data Manipulation Language

**DML** — подмножество языка SQL, предназначенное для создания, изменения и удаления данных в таблицах внутри базы данных. К нему относятся все команды, начинающиеся с `SELECT`, `INSERT`, `UPDATE` и `DELETE`.
(CRUD аббревиатура CREATE READ UPDATE DELETE)
В целом SQL DML очень похожи среди разных баз данных, но иногда бывают серьезные отличия, поэтому всегда полезно сверяться с документацией по конкретной БД в случае проблем.

## SQL: добавление строк в таблицу

```sql
INSERT INTO students (name, age) VALUES
('Anna', 25),
('Maria', 23),
('Roman', 28);
```

Обратите внимание, что поле id существует в таблице, но указывать его значение не обязательно. Тип данных serial позволяет ему заполняться автоматически.

## SQL: извлечение данных

```sql
SELECT * FROM students;
SELECT name, age FROM students;
SELECT * FROM students WHERE age < 18;
SELECT * FROM students ORDER BY age ASC;
SELECT AVG(age) AS 'Средний возраст' FROM students;
```

С помощью `SELECT` можно не просто вытаскивать данные, но и проводить фильтрацию, сортировать и проводить несложные агрегации.

## SQL: изменение данных

```sql
UPDATE students SET age = 26 WHERE name = 'Anna';
```

С помощью `UPDATE` можно изменять любые данные в таблице.
Использование `WHERE` не обязательно, хотя и крайне рекомендуется. Без `WHERE` будут обновлены все существующие строчки в таблице.

## SQL: удаление данных

```sql
DELETE FROM students WHERE id = 1;
```

Чаще всего удаление происходит по `id`, но можно удалять и по любому другому полю:

```sql
DELETE FROM students WHERE name = 'Anna';
```

Возможно использование DELETE вообще без WHERE, в таком случае будут удалены вообще все данные в таблице.
